<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Shibex XRP Journal — Spot & Futures</title>
<style>
  :root{
    --bg:#f5f7fb; --panel:#ffffff; --ink:#0f172a;
    --blue:#2563eb; --blue-600:#1e40af;
    --gray-300:#e5e7eb; --gray-400:#cbd5e1; --gray-600:#475569;
    --danger:#dc2626;
    --shadow:0 10px 24px rgba(15,23,42,.06);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:1120px;margin:0 auto;padding:22px}
  h1{margin:0 0 6px;font-size:26px;color:var(--blue-600)}
  p.sub{margin:0 0 16px;color:var(--gray-600)}
  .card{background:var(--panel);border:1px solid var(--gray-300);border-radius:16px;padding:16px;margin:12px 0;box-shadow:var(--shadow)}
  .grid{display:grid;gap:12px;grid-template-columns:1fr}
  @media(min-width:860px){.grid{grid-template-columns:repeat(4,1fr)}}
  label{display:block;font-size:12px;color:var(--gray-600);margin:0 0 6px}
  .input, select, textarea{width:100%;border:1px solid var(--gray-300);background:#fff;border-radius:10px;padding:10px 12px;font-size:14px;outline:none}
  .input:focus,select:focus,textarea:focus{border-color:var(--blue)}
  /* Uniform button sizing & alignment */
  .controls{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
  .btn{appearance:none;border:1px solid var(--gray-300);background:#eef2ff;color:var(--blue-600);border-radius:10px;font-weight:800;height:44px;cursor:pointer;transition:transform .02s ease, box-shadow .12s ease}
  .btn:hover{box-shadow:0 6px 14px rgba(0,0,0,.08)}
  .btn:active{transform:translateY(1px)}
  .btn.primary{background:var(--blue);color:#fff;border-color:var(--blue)}
  .btn.gray{background:#f8fafc;color:var(--ink)}
  .btn.danger{background:var(--danger);color:#fff;border-color:var(--danger)}
  .statgrid{display:grid;gap:12px;grid-template-columns:1fr}
  @media(min-width:720px){.statgrid{grid-template-columns:repeat(3,1fr)}}
  .tile{border:1px solid var(--gray-300);border-radius:14px;padding:12px;background:#fff}
  .tile h4{margin:0 0 6px;font-size:12px;color:var(--gray-600);font-weight:700}
  .tile p{margin:0;font-size:22px;font-weight:900;color:var(--blue-600)}
  .note{font-size:12px;color:var(--gray-600)}
  .right{text-align:right}
  table{width:100%;border-collapse:collapse;background:#fff;border:1px solid var(--gray-300);border-radius:14px;overflow:hidden}
  th,td{padding:10px;border-top:1px solid var(--gray-300);font-size:13px}
  th{background:#eef2ff;text-align:center;color:var(--blue-600)}
  td{vertical-align:middle}
  td input, td select, td textarea{width:100%;padding:8px;border:1px solid var(--gray-300);border-radius:8px;font-size:13px}
  textarea{resize:vertical}
  .muted{opacity:.7}
</style>
</head>
<body>
<div class="wrap">
  <h1>Shibex XRP Journal (Spot + Futures)</h1>
  <p class="sub"><b id="jscheck">Initializing…</b> &nbsp; Uniform buttons & inputs. Live PnL/ROI. Local autosave.</p>

  <!-- Global settings -->
  <div class="card grid">
    <div>
      <label>USD per 1 XRP (reference)</label>
      <input id="rate" class="input" type="number" step="0.00001" value="0.52000" oninput="render()">
      <div class="note">Used to convert XRP ⇄ USD for totals.</div>
    </div>
    <div>
      <label>Default Pair</label>
      <input id="defPair" class="input" type="text" value="XRPUSD" oninput="render()">
    </div>
    <div>
      <label>Autosave</label>
      <select id="autosave" class="input" onchange="render()">
        <option value="on" selected>On (local device)</option>
        <option value="off">Off</option>
      </select>
    </div>
    <div>
      <label>Journal Date</label>
      <input id="jdate" class="input" type="date" onchange="render()">
    </div>
  </div>

  <!-- Balances -->
  <div class="card grid">
    <div><label>Beginning Balance — Spot (XRP)</label><input id="begSpot" class="input" type="number" step="0.000001" value="0" oninput="render()"></div>
    <div><label>Beginning Balance — Futures (XRP)</label><input id="begFut" class="input" type="number" step="0.000001" value="0" oninput="render()"></div>
    <div><label>Trade Count (auto)</label><input id="tcount" class="input" type="number" value="0" readonly></div>
    <div>
      <label class="muted">Actions</label>
      <div class="controls">
        <button class="btn gray" onclick="addRow()">+ Add Trade</button>
        <button class="btn gray" onclick="removeRow()">– Remove Last</button>
        <button class="btn primary" onclick="downloadCSV()">Download CSV</button>
        <label class="btn gray" style="cursor:pointer">
          Load JSON<input id="load" type="file" accept=".json" style="display:none" onchange="loadJSON(this)">
        </label>
        <button class="btn gray" onclick="saveJSON()">Save JSON</button>
        <button class="btn danger" onclick="resetAll()">Reset</button>
      </div>
    </div>
  </div>

  <!-- Totals -->
  <div class="card">
    <div class="statgrid">
      <div class="tile"><h4>Spot PnL (XRP)</h4><p id="spotX">0.000000 XRP</p><div class="note right" id="spotU">≈ $0.00</div></div>
      <div class="tile"><h4>Futures PnL (XRP)</h4><p id="futX">0.000000 XRP</p><div class="note right" id="futU">≈ $0.00</div></div>
      <div class="tile"><h4>Combined PnL (XRP)</h4><p id="allX">0.000000 XRP</p><div class="note right" id="allU">≈ $0.00</div></div>
    </div>
    <div class="note right" id="ends">Ending — Spot: 0 XRP • Futures: 0 XRP • Combined: 0 XRP</div>
  </div>

  <!-- Trades table -->
  <div class="card">
    <table>
      <thead>
        <tr>
          <th>#</th><th>Date</th><th>Type</th><th>Pair</th><th>Dir</th>
          <th>Qty (XRP)</th><th>Entry (USD)</th><th>Exit (USD)</th><th>Fee (XRP)</th>
          <th>PnL USD</th><th>PnL XRP</th><th>ROI %</th><th>Notes</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
    <p class="note">Type: <b>Spot</b> or <b>Futures</b>. Direction: <b>Long</b> profits if exit &gt; entry; <b>Short</b> profits if exit &lt; entry. PnL XRP = (PnL USD / rate) − fee XRP.</p>
  </div>
</div>

<script>
  var KEY='shibex_xrp_journal_v2';
  var rows=[];

  function $(id){return document.getElementById(id)}
  function today(){return new Date().toISOString().slice(0,10)}
  function s(dir){return dir==='Short'?-1:1}

  function calc(r, rate){
    var q=parseFloat(r.qty), en=parseFloat(r.entry), ex=parseFloat(r.exit), fee=parseFloat(r.fee)||0;
    if(!(isFinite(q)&&isFinite(en)&&isFinite(ex)&&rate>0)) return {usd:null,xrp:null,roi:null};
    var usd=(ex-en)*q*s(r.dir);
    var xrp=usd/rate - fee;
    var not=en*q;
    var roi=not>0?(usd/not):0;
    return {usd:usd,xrp:xrp,roi:roi};
  }
  function fmtUSD(n){return isFinite(n)?('$'+n.toFixed(2)) : ''}
  function fmtXRP(n){return isFinite(n)?(n.toFixed(6)+' XRP') : ''}
  function fmtPct(n){return isFinite(n)?((n*100).toFixed(2)+'%') : ''}

  function newRow(){
    return {date: $('jdate').value||today(), type:'Spot', pair:$('defPair').value||'XRPUSD', dir:'Long', qty:'', entry:'', exit:'', fee:'', notes:''};
  }

  function render(){
    var rate=parseFloat($('rate').value)||0;
    var tb='';
    for(var i=0;i<rows.length;i++){
      var r=rows[i], c=calc(r, rate);
      tb += '<tr>'
        +'<td style="text-align:right">'+(i+1)+'</td>'
        +'<td><input data-i="'+i+'" data-k="date" type="date" value="'+(r.date||today())+'" oninput="chg(this)"></td>'
        +'<td><select data-i="'+i+'" data-k="type" onchange="chg(this)"><option '+(r.type==='Spot'?'selected':'')+'>Spot</option><option '+(r.type==='Futures'?'selected':'')+'>Futures</option></select></td>'
        +'<td><input data-i="'+i+'" data-k="pair" type="text" value="'+(r.pair||'')+'" oninput="chg(this)"></td>'
        +'<td><select data-i="'+i+'" data-k="dir" onchange="chg(this)"><option '+(r.dir==='Long'?'selected':'')+'>Long</option><option '+(r.dir==='Short'?'selected':'')+'>Short</option></select></td>'
        +'<td><input data-i="'+i+'" data-k="qty" type="number" step="0.000001" value="'+(r.qty||'')+'" oninput="chg(this)"></td>'
        +'<td><input data-i="'+i+'" data-k="entry" type="number" step="0.00001" value="'+(r.entry||'')+'" oninput="chg(this)"></td>'
        +'<td><input data-i="'+i+'" data-k="exit" type="number" step="0.00001" value="'+(r.exit||'')+'" oninput="chg(this)"></td>'
        +'<td><input data-i="'+i+'" data-k="fee" type="number" step="0.000001" value="'+(r.fee||'')+'" placeholder="0" oninput="chg(this)"></td>'
        +'<td style="text-align:right">'+fmtUSD(c.usd)+'</td>'
        +'<td style="text-align:right">'+fmtXRP(c.xrp)+'</td>'
        +'<td style="text-align:right">'+fmtPct(c.roi)+'</td>'
        +'<td><textarea data-i="'+i+'" data-k="notes" rows="1" placeholder="setup, reason…" oninput="chg(this)">'+(r.notes||'')+'</textarea></td>'
        +'</tr>';
    }
    $('tbody').innerHTML=tb;

    // Totals
    var spot=0, fut=0;
    for(var j=0;j<rows.length;j++){
      var c=calc(rows[j], rate);
      if(!isFinite(c.xrp)) continue;
      if(rows[j].type==='Spot') spot+=c.xrp; else fut+=c.xrp;
    }
    var bS=parseFloat($('begSpot').value)||0;
    var bF=parseFloat($('begFut').value)||0;
    var endS=bS+spot, endF=bF+fut;

    $('spotX').textContent=fmtXRP(spot);
    $('spotU').textContent='≈ '+fmtUSD(spot*rate);
    $('futX').textContent=fmtXRP(fut);
    $('futU').textContent='≈ '+fmtUSD(fut*rate);
    $('allX').textContent=fmtXRP(spot+fut);
    $('allU').textContent='≈ '+fmtUSD((spot+fut)*rate);
    $('ends').textContent='Ending — Spot: '+fmtXRP(endS)+' • Futures: '+fmtXRP(endF)+' • Combined: '+fmtXRP(endS+endF);
    $('tcount').value=rows.length;

    if($('autosave').value==='on'){
      localStorage.setItem(KEY, JSON.stringify({
        rows:rows, rate:$('rate').value, def:$('defPair').value,
        bS:$('begSpot').value, bF:$('begFut').value, d:$('jdate').value
      }));
    }
    var jc=$('jscheck'); if(jc) jc.textContent='✅ JavaScript is running (inline)';
  }

  function chg(el){
    var i=+el.dataset.i, k=el.dataset.k;
    if(isFinite(i)&&k){ rows[i][k]=el.value; render(); }
  }
  function addRow(){ rows.push(newRow()); render(); }
  function removeRow(){ rows.pop(); render(); }
  function resetAll(){ if(confirm('Clear all rows and totals?')){ rows=[]; render(); } }

  function downloadCSV(){
    var rate=parseFloat($('rate').value)||0;
    var head=['#','Date','Type','Pair','Dir','Qty_XRP','Entry_USD','Exit_USD','Fee_XRP','PnL_USD','PnL_XRP','ROI_pct','Notes'];
    var out=[head.join(',')];
    for(var i=0;i<rows.length;i++){
      var r=rows[i], c=calc(r, rate);
      out.push([
        i+1,r.date||'',r.type||'',r.pair||'',r.dir||'',
        r.qty||'',r.entry||'',r.exit||'',r.fee||'',
        isFinite(c.usd)?c.usd.toFixed(2):'',
        isFinite(c.xrp)?c.xrp.toFixed(6):'',
        isFinite(c.roi)?(c.roi*100).toFixed(2):'',
        '"'+(r.notes||'').replace(/"/g,'""')+'"'
      ].join(','));
    }
    var blob=new Blob([out.join('\n')],{type:'text/csv'});
    var url=URL.createObjectURL(blob), a=document.createElement('a');
    a.href=url; a.download='shibex_xrp_journal.csv'; a.click(); URL.revokeObjectURL(url);
  }
  function saveJSON(){
    var blob=new Blob([JSON.stringify({
      rows:rows, rate:$('rate').value, def:$('defPair').value,
      bS:$('begSpot').value, bF:$('begFut').value, d:$('jdate').value
    },null,2)],{type:'application/json'});
    var url=URL.createObjectURL(blob), a=document.createElement('a');
    a.href=url; a.download='shibex_xrp_journal.json'; a.click(); URL.revokeObjectURL(url);
  }
  function loadJSON(inp){
    var f=inp.files[0]; if(!f) return;
    var r=new FileReader();
    r.onload=function(){
      try{
        var d=JSON.parse(r.result);
        rows=Array.isArray(d.rows)?d.rows:[];
        if(d.rate) $('rate').value=d.rate;
        if(d.def)  $('defPair').value=d.def;
        if(d.bS)   $('begSpot').value=d.bS;
        if(d.bF)   $('begFut').value=d.bF;
        if(d.d)    $('jdate').value=d.d;
        render();
      }catch(e){ alert('Invalid JSON file.'); }
    };
    r.readAsText(f); inp.value='';
  }

  (function init(){
    $('jdate').value=today();
    var s=localStorage.getItem(KEY);
    if(s){
      try{
        var d=JSON.parse(s);
        rows=(Array.isArray(d.rows)&&d.rows.length)?d.rows:[newRow()];
        if(d.rate) $('rate').value=d.rate;
        if(d.def)  $('defPair').value=d.def;
        if(d.bS)   $('begSpot').value=d.bS;
        if(d.bF)   $('begFut').value=d.bF;
        if(d.d)    $('jdate').value=d.d;
      }catch(e){ rows=[newRow()]; }
    }else{
      rows=[newRow()];
    }
    render();
  })();
</script>
</body>
</html>